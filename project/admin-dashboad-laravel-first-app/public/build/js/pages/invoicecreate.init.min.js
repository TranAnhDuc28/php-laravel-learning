var i="$";Array.from(document.getElementsByClassName("product-line-price")).forEach(function(e){e.value=i+"0.00"});var Z=document.getElementById("choices-payment-currency");new Choices(Z,{searchEnabled:!1});document.querySelector("#profile-img-file-input").addEventListener("change",function(){var e=document.querySelector(".user-profile-image"),n=document.querySelector(".profile-img-file-input").files[0],a=new FileReader;a.addEventListener("load",function(){e.src=a.result},!1),n&&a.readAsDataURL(n)});flatpickr("#date-field",{enableTime:!0,dateFormat:"d M, Y, h:i K"});ee();function ee(){var e=document.getElementsByClassName("plus"),n=document.getElementsByClassName("minus");e&&Array.from(e).forEach(function(a){a.onclick=function(l){if(parseInt(a.previousElementSibling.value)<10){l.target.previousElementSibling.value++;var r=a.parentElement.parentElement.previousElementSibling.querySelector(".product-price").value,m=a.parentElement.parentElement.nextElementSibling.querySelector(".product-line-price"),d=a.parentElement.querySelector(".product-quantity").value;g(d,r,m)}}}),n&&Array.from(n).forEach(function(a){a.onclick=function(l){if(parseInt(a.nextElementSibling.value)>1){l.target.nextElementSibling.value--;var r=a.parentElement.parentElement.previousElementSibling.querySelector(".product-price").value,m=a.parentElement.parentElement.nextElementSibling.querySelector(".product-line-price"),d=a.parentElement.querySelector(".product-quantity").value;g(d,r,m)}}})}oe();var te=.125,ae=65,ne=.15;function oe(){Array.from(document.querySelectorAll(".product-removal a")).forEach(function(e){e.addEventListener("click",function(n){de(n),le()})})}function le(){Array.from(document.getElementById("newlink").querySelectorAll("tr")).forEach(function(e,n){var a=n+1;e.querySelector(".product-id").innerHTML=a})}function z(){var e=0;Array.from(document.getElementsByClassName("product")).forEach(function(m){Array.from(m.getElementsByClassName("product-line-price")).forEach(function(d){d.value&&(e+=parseFloat(d.value.slice(1)))})});var n=e*te,a=e*ne,l=e>0?ae:0,r=e+n+l-a;document.getElementById("cart-subtotal").value=i+e.toFixed(2),document.getElementById("cart-tax").value=i+n.toFixed(2),document.getElementById("cart-shipping").value=i+l.toFixed(2),document.getElementById("cart-total").value=i+r.toFixed(2),document.getElementById("cart-discount").value=i+a.toFixed(2),document.getElementById("totalamountInput").value=i+r.toFixed(2),document.getElementById("amountTotalPay").value=i+r.toFixed(2)}function re(){Array.from(document.getElementsByClassName("product-price")).forEach(function(e){e.addEventListener("keyup",function(n){var a=e.parentElement.nextElementSibling.nextElementSibling.querySelector(".product-line-price"),l=n.target.value,r=e.parentElement.nextElementSibling.querySelector(".product-quantity").value;g(l,r,a)})})}re();function g(e,n,a){var l=e*n;l=l.toFixed(2),a.value=i+l,z()}function de(e){e.target.closest("tr").remove(),z()}var _=document.querySelectorAll("[data-trigger]");Array.from(_).forEach(function(e){var n=e;new Choices(n,{placeholderValue:"This is a placeholder set in the config",searchPlaceholderValue:"This is a search placeholder"})});new Cleave("#cardNumber",{blocks:[4,4,4,4],uppercase:!0});var _=document.querySelectorAll('[data-plugin="cleave-phone"]');Array.from(_).forEach(function(e){var n=e;new Cleave(n,{delimiters:["(",")","-"],blocks:[0,3,3,4]})});let t;var ie=localStorage.getItem("invoices-list"),O=localStorage.getItem("option"),J=localStorage.getItem("invoice_no"),o=JSON.parse(ie);if(localStorage.getItem("invoice_no")===null&&localStorage.getItem("option")===null){t="";var me="#VL"+Math.floor(11111111+Math.random()*99999999);document.getElementById("invoicenoInput").value=me}else t=o.find(e=>e.invoice_no===J);if(t!=""&&O=="edit-invoice"){document.getElementById("registrationNumber").value=t.company_details.legal_registration_no,document.getElementById("companyEmail").value=t.company_details.email,document.getElementById("companyWebsite").value=t.company_details.website,new Cleave("#compnayContactno",{prefix:t.company_details.contact_no,delimiters:["(",")","-"],blocks:[0,3,3,4]}),document.getElementById("companyAddress").value=t.company_details.address,document.getElementById("companyaddpostalcode").value=t.company_details.zip_code;var ce=document.querySelectorAll(".user-profile-image");t.img!==""&&(ce.src=t.img),document.getElementById("invoicenoInput").value="#VAL"+t.invoice_no,document.getElementById("invoicenoInput").setAttribute("readonly",!0),document.getElementById("date-field").value=t.date,document.getElementById("choices-payment-status").value=t.status,document.getElementById("totalamountInput").value="$"+t.order_summary.total_amount,document.getElementById("billingName").value=t.billing_address.full_name,document.getElementById("billingAddress").value=t.billing_address.address,new Cleave("#billingPhoneno",{prefix:t.company_details.contact_no,delimiters:["(",")","-"],blocks:[0,3,3,4]}),document.getElementById("billingTaxno").value=t.billing_address.tax,document.getElementById("shippingName").value=t.shipping_address.full_name,document.getElementById("shippingAddress").value=t.shipping_address.address,new Cleave("#shippingPhoneno",{prefix:t.company_details.contact_no,delimiters:["(",")","-"],blocks:[0,3,3,4]}),document.getElementById("shippingTaxno").value=t.billing_address.tax;var y=t.prducts,V=1;do V++,y.length>1&&document.getElementById("add-item").click();while(y.length-1>=V);var s=1;setTimeout(()=>{Array.from(y).forEach(function(e){document.getElementById("productName-"+s).value=e.product_name,document.getElementById("productDetails-"+s).value=e.product_details,document.getElementById("productRate-"+s).value=e.rates,document.getElementById("product-qty-"+s).value=e.quantity,document.getElementById("productPrice-"+s).value="$"+e.rates*e.quantity,s++})},300),document.getElementById("cart-subtotal").value="$"+t.order_summary.sub_total,document.getElementById("cart-tax").value="$"+t.order_summary.estimated_tex,document.getElementById("cart-discount").value="$"+t.order_summary.discount,document.getElementById("cart-shipping").value="$"+t.order_summary.shipping_charge,document.getElementById("cart-total").value="$"+t.order_summary.total_amount,document.getElementById("choices-payment-type").value=t.payment_details.payment_method,document.getElementById("cardholderName").value=t.payment_details.card_holder_name,new Cleave("#cardNumber",{prefix:t.payment_details.card_number,delimiter:" ",blocks:[4,4,4,4],uppercase:!0}),document.getElementById("amountTotalPay").value="$"+t.order_summary.total_amount,document.getElementById("exampleFormControlTextarea1").value=t.notes}document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("invoice_form");document.getElementsByClassName("needs-validation"),e.addEventListener("submit",function(n){n.preventDefault();var a=document.getElementById("invoicenoInput").value.slice(4),l=document.getElementById("companyEmail").value,r=document.getElementById("date-field").value,m=document.getElementById("totalamountInput").value.slice(1),d=document.getElementById("choices-payment-status").value,p=document.getElementById("billingName").value,E=document.getElementById("billingAddress").value,I=document.getElementById("billingPhoneno").value.replace(/[^0-9]/g,""),f=document.getElementById("billingTaxno").value,h=document.getElementById("shippingName").value,b=document.getElementById("shippingAddress").value,B=document.getElementById("shippingPhoneno").value.replace(/[^0-9]/g,""),x=document.getElementById("shippingTaxno").value,S=document.getElementById("choices-payment-type").value,q=document.getElementById("cardholderName").value,A=document.getElementById("cardNumber").value.replace(/[^0-9]/g,""),N=document.getElementById("amountTotalPay").value.slice(1),w=document.getElementById("registrationNumber").value.replace(/[^0-9]/g,""),C=document.getElementById("companyEmail").value,j=document.getElementById("companyWebsite").value,k=document.getElementById("compnayContactno").value.replace(/[^0-9]/g,""),T=document.getElementById("companyAddress").value,F=document.getElementById("companyaddpostalcode").value,L=document.getElementById("cart-subtotal").value.slice(1),P=document.getElementById("cart-tax").value.slice(1),$=document.getElementById("cart-discount").value.slice(1),R=document.getElementById("cart-shipping").value.slice(1),D=document.getElementById("cart-total").value.slice(1),M=document.getElementById("exampleFormControlTextarea1").value,K=document.getElementsByClassName("product"),u=1,v=[];if(Array.from(K).forEach(c=>{var W=c.querySelector("#productName-"+u).value,H=c.querySelector("#productDetails-"+u).value,U=parseInt(c.querySelector("#productRate-"+u).value),Y=parseInt(c.querySelector("#product-qty-"+u).value),G=c.querySelector("#productPrice-"+u).value.split("$"),X={product_name:W,product_details:H,rates:U,quantity:Y,amount:parseInt(G[1])};v.push(X),u++}),e.checkValidity()===!1)e.classList.add("was-validated");else{if(O=="edit-invoice"&&J==a)objIndex=o.findIndex(c=>c.invoice_no==a),o[objIndex].invoice_no=a,o[objIndex].customer=p,o[objIndex].img="",o[objIndex].email=l,o[objIndex].date=r,o[objIndex].invoice_amount=m,o[objIndex].status=d,o[objIndex].billing_address={full_name:p,address:E,phone:I,tax:f},o[objIndex].shipping_address={full_name:h,address:b,phone:B,tax:x},o[objIndex].payment_details={payment_method:S,card_holder_name:q,card_number:A,total_amount:N},o[objIndex].company_details={legal_registration_no:w,email:C,website:j,contact_no:k,address:T,zip_code:F},o[objIndex].order_summary={sub_total:L,estimated_tex:P,discount:$,shipping_charge:R,total_amount:D},o[objIndex].prducts=v,o[objIndex].notes=M,localStorage.removeItem("invoices-list"),localStorage.removeItem("option"),localStorage.removeItem("invoice_no"),localStorage.setItem("invoices-list",JSON.stringify(o));else{var Q={invoice_no:a,customer:p,img:"",email:l,date:r,invoice_amount:m,status:d,billing_address:{full_name:p,address:E,phone:I,tax:f},shipping_address:{full_name:h,address:b,phone:B,tax:x},payment_details:{payment_method:S,card_holder_name:q,card_number:A,total_amount:N},company_details:{legal_registration_no:w,email:C,website:j,contact_no:k,address:T,zip_code:F},order_summary:{sub_total:L,estimated_tex:P,discount:$,shipping_charge:R,total_amount:D},prducts:v,notes:M};localStorage.setItem("new_data_object",JSON.stringify(Q))}window.location.href="apps-invoices-list"}})});
