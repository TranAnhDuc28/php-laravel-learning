localStorage.removeItem("ticket-list");var f=function(t){var a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=new Date(t),s=""+a[n.getMonth()],l=""+n.getDate(),h=n.getFullYear();return s.length<2&&(s="0"+s),l.length<2&&(l="0"+l),[l+" "+s,h].join(", ")},_=document.getElementById("checkAll");_&&(_.onclick=function(){for(var e=document.querySelectorAll('.form-check-all input[type="checkbox"]'),t=document.querySelectorAll('.form-check-all input[type="checkbox"]:checked').length,a=0;a<e.length;a++)e[a].checked=this.checked,e[a].checked?e[a].closest("tr").classList.add("table-active"):e[a].closest("tr").classList.remove("table-active");t>0?document.getElementById("remove-actions").style.display="none":document.getElementById("remove-actions").style.display="block"});var b=8,E=!1,x={valueNames:["id","tasks_name","client_name","assignedto","create_date","due_date","status","priority"],page:b,pagination:!0,plugins:[ListPagination({left:2,right:2})]},i=new List("ticketsList",x).on("updated",function(e){e.matchingItems.length==0?document.getElementsByClassName("noresult")[0].style.display="block":document.getElementsByClassName("noresult")[0].style.display="none";var t=e.i==1,a=e.i>e.matchingItems.length-e.page;document.querySelector(".pagination-prev.disabled")&&document.querySelector(".pagination-prev.disabled").classList.remove("disabled"),document.querySelector(".pagination-next.disabled")&&document.querySelector(".pagination-next.disabled").classList.remove("disabled"),t&&document.querySelector(".pagination-prev").classList.add("disabled"),a&&document.querySelector(".pagination-next").classList.add("disabled"),e.matchingItems.length<=b?document.querySelector(".pagination-wrap").style.display="none":document.querySelector(".pagination-wrap").style.display="flex",e.matchingItems.length==b&&document.querySelector(".pagination.listjs-pagination").firstElementChild.children[0].click(),e.matchingItems.length>0?document.getElementsByClassName("noresult")[0].style.display="none":document.getElementsByClassName("noresult")[0].style.display="block"});const S=new XMLHttpRequest;S.onload=function(){var e=JSON.parse(this.responseText);Array.from(e).forEach(function(t){i.add({id:'<a href="javascript:void(0);" onclick="ViewTickets(this)" data-id="'+t.id+'" class="fw-medium link-primary ticket-id">#VLZ'+t.id+"</a>",tasks_name:t.tasks_name,client_name:t.client_name,assignedto:t.assignedto,create_date:f(t.create_date),due_date:f(t.due_date),priority:L(t.priority),status:B(t.status)}),i.sort("id",{order:"desc"}),w()}),i.remove("id",'<a href="javascript:void(0);" onclick="ViewTickets(this)" data-id="001" class="fw-medium link-primary">#VLZ001</a>')};S.open("GET","build/json/support-tickets-list.json");S.send();isCount=new DOMParser().parseFromString(i.items.slice(-1)[0]._values.id,"text/html");isCount.body.firstElementChild.innerHTML;var v=document.getElementById("orderId"),u=document.getElementById("tasksTitle-field"),m=document.getElementById("client_nameName-field"),p=document.getElementById("assignedtoName-field"),y=document.getElementById("date-field"),g=document.getElementById("duedate-field"),r=document.getElementById("priority-field"),d=document.getElementById("ticket-status");document.getElementById("add-btn");document.getElementById("edit-btn");var M=document.getElementsByClassName("remove-item-btn"),T=document.getElementsByClassName("edit-item-btn");w();function F(e){i.filter(function(t){var a=!1;return matchData=new DOMParser().parseFromString(t.values().status,"text/html"),matchData.body.firstElementChild.innerHTML,a=!0,a}),i.update()}document.getElementById("showModal").addEventListener("show.bs.modal",function(e){e.relatedTarget.classList.contains("edit-item-btn")?(document.getElementById("exampleModalLabel").innerHTML="Edit Ticket",document.getElementById("showModal").querySelector(".modal-footer").style.display="block",document.getElementById("add-btn").innerHTML="Update"):e.relatedTarget.classList.contains("add-btn")?(document.getElementById("modal-id").style.display="none",document.getElementById("exampleModalLabel").innerHTML="Add Ticket",document.getElementById("showModal").querySelector(".modal-footer").style.display="block",document.getElementById("add-btn").innerHTML="Add Ticket"):(document.getElementById("exampleModalLabel").innerHTML="List Ticket",document.getElementById("showModal").querySelector(".modal-footer").style.display="none")});q();document.getElementById("showModal").addEventListener("hidden.bs.modal",function(){I()});document.querySelector("#ticketsList").addEventListener("click",function(){q()});var C=document.getElementById("ticketTable");C.getElementsByTagName("tr");C.querySelectorAll(".list tr");var k=14,A=document.querySelectorAll(".tablelist-form");Array.prototype.slice.call(A).forEach(function(e){e.addEventListener("submit",function(t){if(!e.checkValidity())t.preventDefault(),t.stopPropagation();else if(t.preventDefault(),u.value!==""&&m.value!==""&&p.value!==""&&y.value!==""&&g.value!==""&&d.value!==""&&r.value!==""&&!E)i.add({id:'<a href="javascript:void(0);" onclick="ViewTickets(this)" data-id="'+k+'" class="fw-medium link-primary ticket-id">#VLZ'+k+"</a>",tasks_name:u.value,client_name:m.value,assignedto:p.value,create_date:y.value,due_date:g.value,priority:L(r.value),status:B(d.value)}),i.sort("id",{order:"desc"}),document.getElementById("close-modal").click(),I(),w(),F(),k++,Swal.fire({position:"center",icon:"success",title:"Ticket inserted successfully!",showConfirmButton:!1,timer:2e3,showCloseButton:!0});else if(u.value!==""&&m.value!==""&&p.value!==""&&y.value!==""&&g.value!==""&&d.value!==""&&r.value!==""&&E){var a=i.get({id:v.value});Array.from(a).forEach(function(n){isid=new DOMParser().parseFromString(n._values.id,"text/html");var s=isid.body.firstElementChild.innerHTML;s==itemId&&n.values({id:'<a href="javascript:void(0);" onclick="ViewTickets(this)" data-id="'+v.value+'" class="fw-medium link-primary">'+v.value+"</a>",tasks_name:u.value,client_name:m.value,create_date:f(y.value),due_date:f(g.value),priority:L(r.value),status:B(d.value)})}),document.getElementById("close-modal").click(),I(),Swal.fire({position:"center",icon:"success",title:"Ticket updated Successfully!",showConfirmButton:!1,timer:2e3,showCloseButton:!0})}},!1)});var c=new Choices(r,{searchEnabled:!1}),o=new Choices(d,{searchEnabled:!1});function B(e){switch(e){case"Open":return'<span class="badge bg-success-subtle text-success text-uppercase">'+e+"</span>";case"Inprogress":return'<span class="badge bg-warning-subtle text-warning text-uppercase">'+e+"</span>";case"Closed":return'<span class="badge bg-danger-subtle text-danger text-uppercase">'+e+"</span>";case"New":return'<span class="badge bg-info-subtle text-info text-uppercase">'+e+"</span>"}}function L(e){switch(e){case"High":return'<span class="badge bg-danger text-uppercase">'+e+"</span>";case"Low":return'<span class="badge bg-success text-uppercase">'+e+"</span>";case"Medium":return'<span class="badge bg-warning text-uppercase">'+e+"</span>"}}function q(){Array.from(document.getElementsByName("checkAll")).forEach(function(e){e.addEventListener("change",function(t){e.checked==!0?t.target.closest("tr").classList.add("table-active"):t.target.closest("tr").classList.remove("table-active");var a=document.querySelectorAll('[name="checkAll"]:checked').length;t.target.closest("tr").classList.contains("table-active"),a>0?document.getElementById("remove-actions").style.display="block":document.getElementById("remove-actions").style.display="none"})})}function w(){M&&Array.from(M).forEach(function(e){e.addEventListener("click",function(t){t.target.closest("tr").children[1].innerText,itemId=t.target.closest("tr").children[1].innerText;var a=i.get({id:itemId});Array.from(a).forEach(function(n){deleteid=new DOMParser().parseFromString(n._values.id,"text/html");var s=deleteid.body.firstElementChild,l=deleteid.body.firstElementChild.innerHTML;l==itemId&&document.getElementById("delete-record").addEventListener("click",function(){i.remove("id",s.outerHTML),document.getElementById("deleteRecord-close").click()})})})}),T&&Array.from(T).forEach(function(e){e.addEventListener("click",function(t){t.target.closest("tr").children[1].innerText,itemId=t.target.closest("tr").children[1].innerText;var a=i.get({id:itemId});Array.from(a).forEach(function(n){isid=new DOMParser().parseFromString(n._values.id,"text/html");var s=isid.body.firstElementChild.innerHTML;if(s==itemId){E=!0,v.value=s,u.value=n._values.tasks_name,m.value=n._values.client_name,p.value=n._values.assignedto,y.value=n._values.create_date,g.value=n._values.due_date,c&&c.destroy(),c=new Choices(r,{searchEnabled:!1}),val=new DOMParser().parseFromString(n._values.priority,"text/html");var l=val.body.firstElementChild.innerHTML;c.setChoiceByValue(l),o&&o.destroy(),o=new Choices(d,{searchEnabled:!1}),val=new DOMParser().parseFromString(n._values.status,"text/html");var h=val.body.firstElementChild.innerHTML;o.setChoiceByValue(h),flatpickr("#date-field",{dateFormat:"d M, Y",defaultDate:n._values.create_date}),flatpickr("#duedate-field",{dateFormat:"d M, Y",defaultDate:n._values.due_date})}})})})}function I(){u.value="",m.value="",p.value="",y.value="",g.value="",c&&c.destroy(),c=new Choices(r),o&&o.destroy(),o=new Choices(d)}document.querySelector(".pagination-next").addEventListener("click",function(){document.querySelector(".pagination.listjs-pagination")&&document.querySelector(".pagination.listjs-pagination").querySelector(".active")&&document.querySelector(".pagination.listjs-pagination").querySelector(".active").nextElementSibling.children[0].click()});document.querySelector(".pagination-prev").addEventListener("click",function(){document.querySelector(".pagination.listjs-pagination")&&document.querySelector(".pagination.listjs-pagination").querySelector(".active")&&document.querySelector(".pagination.listjs-pagination").querySelector(".active").previousSibling.children[0].click()});
