const g=n=>{if(!n)return null;const o=new Date(n),s=o.getHours(),t=o.getMinutes();return isNaN(s)?null:`${s}:${t.toString().padStart(2,"0")}`},L=n=>{if(!n)return"";try{const[o,s]=n.split(":");let t=parseInt(o);const i=parseInt(s),r=t>=12?"PM":"AM";return`${t%12||12}:${i.toString().padStart(2,"0")} ${r}`}catch{return console.error("Invalid time format:",n),""}},b=n=>{const o=new Date(n),s=["January","February","March","April","May","June","July","August","September","October","November","December"],t=String(o.getDate()).padStart(2,"0"),i=s[o.getMonth()],r=o.getFullYear();return`${t} ${i}, ${r}`},f=n=>{if(!n)return null;const o=new Date(n),s=`${o.getMonth()+1}`.padStart(2,"0"),t=`${o.getDate()}`.padStart(2,"0");return`${o.getFullYear()}-${s}-${t}`},I=(n,o="en-GB",s="short")=>{if(!n)return null;const t=S[s]||S.short;return n.toLocaleDateString(o,t)},S={numeric:{day:"numeric",month:"numeric",year:"numeric"},short:{day:"numeric",month:"short",year:"numeric"},long:{day:"numeric",month:"long",year:"numeric"},compact:{day:"2-digit",month:"2-digit",year:"numeric"},shortYear:{day:"numeric",month:"short",year:"2-digit"},monthFirst:{month:"short",day:"numeric",year:"numeric"},yearFirst:{year:"numeric",month:"short",day:"numeric"}},w=n=>{const o=document.getElementById("upcoming-event-list");o.innerHTML="",eventList.sort((s,t)=>new Date(s.start)-new Date(t.start)),n.forEach(s=>{var u;const t=s.title||"",i=s.description||"",r=new Date(s.start),a=s.end?new Date(s.end):null,p=I(r);let c=null;a&&(a.setDate(a.getDate()-1),c=I(a)),c=a&&c!==p?" to "+c:"";let m=L(g(r)),l=a?L(g(a)):null;m===l&&(m="Full day event",l=null);const v=l?` to ${l}`:"",E=`
        <div class='card mb-3'>
            <div class='card-body'>
                <div class='d-flex mb-3'>
                    <div class='flex-grow-1'>
                        <i class='mdi mdi-checkbox-blank-circle me-2 text-${((u=s.classNames)==null?void 0:u.split("-")[1])||"primary"}'></i>
                        <span class='fw-medium'>${p}${c}</span>
                    </div>
                    <div class='flex-shrink-0'>
                        <small class='badge bg-primary-subtle text-primary ms-auto'>
                            ${m}${v}
                        </small>
                    </div>
                </div>
                <h6 class='card-title fs-16'>${t}</h6>
                <p class='text-muted text-truncate-two-lines mb-0'>${i}</p>
            </div>
        </div>`;o.innerHTML+=E})},e={calendarElement:document.getElementById("calendar"),externalEventElement:document.getElementById("external-events"),modalElement:document.getElementById("event-modal"),modalTitle:document.getElementById("modal-title"),formEvent:document.getElementById("form-event"),inpEventId:document.getElementById("eventid"),inpEventCategory:document.getElementById("event-category"),inpEventTitle:document.getElementById("event-title"),inpEventDatePicker:document.getElementById("event-start-date"),eventTimeSection:document.getElementById("event-time"),inpStartTimePicker:document.getElementById("timepicker1"),inpEndTimePicker:document.getElementById("timepicker2"),inpEventLocation:document.getElementById("event-location"),inpEventDescription:document.getElementById("event-description"),btnSaveEvent:document.getElementById("btn-save-event"),btnDeleteEvent:document.getElementById("btn-delete-event"),btnEditEvent:document.getElementById("edit-event-btn"),btnShowModalNewEvent:document.getElementById("btn-new-event"),tagInfoEventStartDate:document.getElementById("event-start-date-tag"),tagInfoTimeStartEvent:document.getElementById("event-timepicker1-tag"),tagInfoTimeEndEvent:document.getElementById("event-timepicker2-tag"),tagInfoLocationEvent:document.getElementById("event-location-tag"),tagInfoDescriptionEvent:document.getElementById("event-description-tag")},k=()=>{const n={enableTime:!0,noCalendar:!0};flatpickr(e.inpEventDatePicker,{enableTime:!1,mode:"range",minDate:"today",onchange:(o,s)=>{const t=s.includes("to"),i=e.inpStartTimePicker.parentNode,r=e.inpEndTimePicker.parentNode;t?e.eventTimeSection.setAttribute("hidden","true"):(e.eventTimeSection.removeAttribute("hidden"),i.classList.remove("d-none"),e.inpStartTimePicker.classList.replace("d-none","d-block"),r.classList.remove("d-none"),e.inpEndTimePicker.classList.replace("d-none","d-block"))}}),flatpickr(e.inpStartTimePicker,n),flatpickr(e.inpEndTimePicker,n)},A=()=>{e.inpEventDatePicker.flatpickr().clear(),e.inpStartTimePicker.flatpickr().clear(),e.inpEndTimePicker.flatpickr().clear()},y=e.inpStartTimePicker.parentNode,h=e.inpEndTimePicker.parentNode,N=e.inpEventDatePicker.parentNode,T=new bootstrap.Modal(e.modalElement,{keyboard:!1}),P=(n,o)=>{let s=new Choices(e.inpEventCategory,{searchEnabled:!1});if(e.formEvent.reset(),e.btnDeleteEvent.setAttribute("hidden","true"),T.show(),e.formEvent.classList.remove("was-validated"),o==="create")e.modalTitle.innerText="Add Event",e.btnEditEvent.setAttribute("data-id","new-event"),e.btnEditEvent.click(),e.btnEditEvent.setAttribute("hidden","true");else if(o==="overview"){const t=n;e.btnSaveEvent.setAttribute("hidden","true"),e.btnEditEvent.removeAttribute("hidden"),e.btnEditEvent.setAttribute("data-id","edit-event"),e.btnEditEvent.innerHTML="Edit",$(),k(),A(),e.modalTitle.innerHTML=t.title,e.inpEventId.value=t.id,e.inpEventTitle.value=t.title,e.inpEventLocation.value=t.extendedProps.location??"No Location",e.inpEventDescription.value=t.extendedProps.description??"No Description",e.tagInfoLocationEvent.innerHTML=t.extendedProps.location??"No Location",e.tagInfoDescriptionEvent.innerHTML=t.extendedProps.description??"No Description",t.classNames[0]&&(s.destroy(),s=new Choices(e.inpEventCategory,{searchEnabled:!1}),s.setChoiceByValue(t.classNames[0]));const i=t.start;let r=t.end,a=r?new Date(r.getTime()-24*60*60*1e3):null;e.tagInfoEventStartDate.innerHTML=a?`${b(i)} to ${b(a)}`:b(i);const p=a?`${f(i)} to ${f(a)}`:f(i);flatpickr(e.inpEventDatePicker,{defaultDate:p,altInput:!0,altFormat:"j F Y",dateFormat:"Y-m-d",mode:"range",onchange:(E,u)=>{u.includes(" to ")?e.eventTimeSection.setAttribute("hidden","true"):(e.eventTimeSection.removeAttribute("hidden"),y.classList.remove("d-none"),e.inpStartTimePicker.classList.replace("d-none","d-block"),h.classList.remove("d-none"),e.inpEndTimePicker.classList.replace("d-none","d-block"))}});const c=g(t.start),m=g(t.end),l=L(c),v=L(m),d={enableTime:!0,noCalendar:!0,dateFormat:"H:i"};c===m?(e.eventTimeSection.setAttribute("hidden","true"),flatpickr(e.inpStartTimePicker,{...d}),flatpickr(e.inpEndTimePicker,{...d})):(e.eventTimeSection.removeAttribute("hidden"),flatpickr(e.inpStartTimePicker,{...d,defaultDate:c}),flatpickr(e.inpEndTimePicker,{...d,defaultDate:m}),e.tagInfoTimeStartEvent.innerHTML=l,e.tagInfoTimeEndEvent.innerHTML=v),e.btnDeleteEvent.removeAttribute("hidden")}},x=()=>{e.formEvent.classList.remove("view-event"),e.inpEventCategory.classList.replace("d-none","d-block"),e.inpEventTitle.classList.replace("d-none","d-block"),N.classList.remove("d-none"),e.inpEventDatePicker.classList.replace("d-none","d-block"),y.classList.remove("d-none"),e.inpStartTimePicker.classList.replace("d-none","d-block"),h.classList.remove("d-none"),e.inpEndTimePicker.classList.replace("d-none","d-block"),e.inpEventLocation.classList.replace("d-none","d-block"),e.inpEventDescription.classList.replace("d-none","d-block"),e.btnSaveEvent.removeAttribute("hidden"),e.tagInfoEventStartDate.classList.replace("d-block","d-none"),e.tagInfoTimeStartEvent.classList.replace("d-block","d-none"),e.tagInfoTimeEndEvent.classList.replace("d-block","d-none"),e.tagInfoLocationEvent.classList.replace("d-block","d-none"),e.tagInfoDescriptionEvent.classList.replace("d-block","d-none")},$=()=>{e.formEvent.classList.add("view-event"),e.inpEventCategory.classList.replace("d-block","d-none"),e.inpEventTitle.classList.replace("d-block","d-none"),N.classList.add("d-none"),e.inpEventDatePicker.classList.replace("d-block","d-none"),e.eventTimeSection.setAttribute("hidden","true"),y.classList.add("d-none"),e.inpStartTimePicker.classList.replace("d-block","d-none"),h.classList.add("d-none"),e.inpEndTimePicker.classList.replace("d-block","d-none"),e.inpEventLocation.classList.replace("d-block","d-none"),e.inpEventDescription.classList.replace("d-block","d-none"),e.btnSaveEvent.setAttribute("hidden","true"),e.tagInfoEventStartDate.classList.replace("d-none","d-block"),e.tagInfoTimeStartEvent.classList.replace("d-none","d-block"),e.tagInfoTimeEndEvent.classList.replace("d-none","d-block"),e.tagInfoLocationEvent.classList.replace("d-none","d-block"),e.tagInfoDescriptionEvent.classList.replace("d-none","d-block")},B=n=>{const o=n.getAttribute("data-id");o==="new-event"?(e.modalTitle.innerHTML="Add Event",e.btnSaveEvent.innerHTML="Add Event",x()):o==="edit-event"?(n.innerHTML="Cancel",n.setAttribute("data-id","cancel-event"),e.btnSaveEvent.innerHTML="Update Event",x()):(n.innerHTML="Edit",n.setAttribute("data-id","edit-event"),$())},M=()=>{const n=window.innerWidth;return n<=768?"listMonth":n<1200?"timeGridWeek":"dayGridMonth"},D=(n,o)=>{new FullCalendar.Draggable(o,{itemSelector:".external-event",eventData:t=>({id:Math.floor(1e4*Math.random()),title:t.innerText,allDay:!0,start:new Date,className:t.getAttribute("data-class")})});const s=new FullCalendar.Calendar(n,{timeZone:"local",editable:!0,droppable:!0,selectable:!0,navLinks:!0,initialView:M(),themeSystem:"bootstrap5",headerToolbar:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listMonth"},events:window.eventList,windowResize:t=>{const i=M();s.changeView(i)},eventResize:t=>{const i=t.event,r=window.eventList.findIndex(a=>a.id===i.id);if(r!==-1&&window.eventList[r]){const a=window.eventList[r];a.title=i.title,a.start=i.start,a.end=i.end||null,a.allDay=i.allDay,a.className=i.classNames[0],a.location=i._def.extendedProps.location||"",a.description=i._def.extendedProps.description||""}w(window.eventList)},eventClick:t=>{t.jsEvent.preventDefault(),P(t,"edit")},dateClick:t=>{P(t,"create")},eventReceive:t=>{const i={id:parseInt(t.event.id),title:t.event.title,start:t.event.start,allDay:t.event.allDay,className:t.event.classNames[0]};window.eventList.push(i),w(window.eventList)},eventDrop:t=>{const i=t.event,r=window.eventList.findIndex(a=>a.id===t.event.id);if(r!==-1&&window.eventList[r]){const a=window.eventList[r];a.title=i.title,a.start=i.start,a.end=i.end||null,a.allDay=i.allDay,a.className=i.classNames[0],a.location=i._def.extendedProps.location||"",a.description=i._def.extendedProps.description||"",w(window.eventList)}}});return s},C=()=>{let n=null;e.formEvent.addEventListener("submit",o=>{o.preventDefault();const s=e.inpEventTitle.value,t=e.inpEventCategory.value,i=e.inpEventDatePicker.value.split(" to "),r=e.inpEventLocation.value,a=e.inpEventDescription.value,p=e.inpEventId.value;let c=!1,m=window.eventList.length+1,l,v;if(i.length>1)l=new Date(i[0].trim()),v=new Date(i[1].trim()),v.setDate(v.getDate()+1),c=!0;else{const d=i[0].trim(),E=e.inpStartTimePicker.value.trim(),u=e.inpEndTimePicker.value.trim();l=new Date(`${d}T${E}`),v=new Date(`${d}T${u}`)}if(e.formEvent.checkValidity()===!1){e.formEvent.classList.add("was-validated");return}if(n){n.setProp("id",p),n.setProp("title",s),n.setProp("classNames",[t]),n.setStart(l),n.setEnd(v),n.setAllDay(c),n.setExtendedProp("description",a),n.setExtendedProp("location",r);const d=window.eventList.findIndex(E=>E.id===n.id);window.eventList[d]&&(window.eventList[d].title=s,window.eventList[d].start=l,window.eventList[d].end=v,window.eventList[d].allDay=c,window.eventList[d].className=t,window.eventList[d].description=a,window.eventList[d].location=r),D.render()}else{const d={id:m,title:s,start:l,end:v,allDay:c,className:t,description:a,location:r};D.addEvent(d),window.eventList.push(d)}T.hide(),w(window.eventList)}),e.btnDeleteEvent.addEventListener("click",()=>{n&&(window.eventList=window.eventList.filter(o=>o.id!==n.id),n.remove(),n=null,T.hide(),w(window.eventList))}),e.btnSaveEvent.addEventListener("click",()=>{n=null,e.formEvent.reset(),e.formEvent.classList.remove("was-validated")})};window.eventList=window.eventList||[];document.addEventListener("DOMContentLoaded",()=>{k(),D(e.calendarElement,e.externalEventElement).render(),w(window.eventList),C(),e.btnEditEvent.addEventListener("click",o=>{B(o.target)}),e.btnShowModalNewEvent.addEventListener("click",o=>{A(),k(),e.btnShowModalNewEvent.setAttribute("data-id","new-event"),e.btnShowModalNewEvent.click(),e.btnShowModalNewEvent.setAttribute("hidden","true")})});
